<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ¨ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼æŠ•ç¥¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      margin: 0;
      max-width: 600px;
      margin: auto;
    }
    h2 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
    }
    .menu-item {
      margin: 8px 0;
    }
    .ranking {
      margin-bottom: 30px;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      margin-bottom: 14px;
      font-size: 1em;
    }
    button {
      background-color: black;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <h2>ğŸ¥‡ æ¨ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
  <div id="ranking" class="ranking">èª­ã¿è¾¼ã¿ä¸­...</div>

  <h2>ğŸ“© æŠ•ç¥¨ã™ã‚‹</h2>
  <form id="vote-form">
    <label for="menu">æ¨ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š</label>
    <select id="menu" required>
      <option value="">-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠ --</option>
      <option value="å”æšã’">å”æšã’</option>
      <option value="å±±èŠ‹ã®ç«œç”°æšã’">å±±èŠ‹ã®ç«œç”°æšã’</option>
      <option value="ãƒãƒ†ã‚µãƒ©">ãƒãƒ†ã‚µãƒ©</option>
      <option value="ã ã—å·»ãåµ">ã ã—å·»ãåµ</option>
    </select>

    <label for="comment">ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰:</label>
    <textarea id="comment" rows="3" placeholder="ç†ç”±ã‚„ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆãªã©"></textarea>

    <button type="submit">æŠ•ç¥¨ã™ã‚‹</button>
  </form>

  <h2>ğŸ“ åº—èˆ—ã®è©•ä¾¡</h2>
  <button onclick="window.open('https://forms.gle/YOUR_GOOGLE_FORM_URL', '_blank')">è©•ä¾¡ãƒ•ã‚©ãƒ¼ãƒ ã«é€²ã‚€</button>

  <script>
    const SUPABASE_URL = 'https://iirzcvptqjnswimxoyds.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlpcnpjdnB0cWpuc3dpbXhveWRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMDk3MzEsImV4cCI6MjA2NjU4NTczMX0.SBSW6h0lF4_YW0Rmnr1rDwTg1ApI-U2kCfkHJHZHy6E';

    async function fetchRanking() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/votes?select=menu_name`, {
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: `Bearer ${SUPABASE_KEY}`
        }
      });
      const data = await res.json();
      const counts = {};
      data.forEach(vote => {
        counts[vote.menu_name] = (counts[vote.menu_name] || 0) + 1;
      });
      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
      const rankingDiv = document.getElementById('ranking');
      rankingDiv.innerHTML = sorted.length === 0 ? 'ã¾ã æŠ•ç¥¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚' : '';
      sorted.forEach(([menu, count], i) => {
        rankingDiv.innerHTML += `<div class="menu-item">#${i + 1} ${menu} - ${count}ç¥¨</div>`;
      });
    }

    fetchRanking();

    document.getElementById('vote-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const menu = document.getElementById('menu').value;
      const comment = document.getElementById('comment').value;

      const res = await fetch(`${SUPABASE_URL}/rest/v1/votes`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: `Bearer ${SUPABASE_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation'
        },
        body: JSON.stringify({ menu_name: menu, comment })
      });

      if (res.ok) {
        alert('æŠ•ç¥¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼');
        document.getElementById('vote-form').reset();
        fetchRanking();
      } else {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
      }
    });
  </script>
</body>
</html>
